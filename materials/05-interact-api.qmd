---
title: "Iteract with your API"
format: html
editor_options: 
  chunk_output_type: console
  canonical: true
---

## Goals

The goals of this activity are to:

-   Make a request to our Posit Cola API on Posit Connect.


## Task 0 - Add your API URL

Before starting this activity, we need to visit Posit Connect and view the API that we created in the previous activity. The API URL will be used to make requests to the API. We will convert this URL into a `vetiver` endpoint which makes API requests even easier!

```{r}
#| label: setup

library(vetiver)
library(tibble)

# Add your API URL here
api_url <- "https://connect.posit.it/content/127ec7f3-d930-4f52-8f49-52b03f0c0250"

# This will ensure your CONNECT_API_KEY environment variable is set
API_KEY <- Sys.getenv("CONNECT_API_KEY")

# Convert the API URL into a vetiver endpoint
endpoint <- vetiver::vetiver_endpoint(paste0(api_url, "/predict"))
```

## Task 1 - Make a request to the API

We first need to create some data to send to the API. This data should match the input format of the model we deployed in the previous activity.

```{r}
#| label: create-request-data

# Create a tibble with the input data. Feel free to change the values!
request_data <- tibble::tibble(
      units_sold = 85,
      unit_price = 1.50,
      product = "Posit Classic",
      region = "Europe",
      store_type = "Supermarket",
  )
```

Now we can send this data to the API using the `vetiver_predict()` function. This function will send a POST request to the API and return the response.

```{r}
#| label: make-api-request

response <- predict(endpoint,
            request_data,
            httr::add_headers(Authorization = paste("Key", API_KEY)))$.pred

# Print the response
response
```

And that's it! You've successfully made a request to your API and received a response. The response contains the predicted sales for the input data we provided.
